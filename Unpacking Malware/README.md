<h1>Introduction</h1>
Modern malware typically employs a variety of defense evasion techniques, including packing. As malware unpacks additional code, it needs to inject it somewhere in order to execute. There are a variety of ways to do this, but the most common are DLL Injection, PE Injection, and Process Hollowing. These techniques are all explained in further detail later in the post. While these techniques can hinder the analysis process, they can be easily defeated using a debugger such as <a href="https://x64dbg.com/#start" target="_new">x64dbg</a>.
<h1>Three Main Ideas</h1>
1. Malware developers are increasingly leaning on defense evasion techniques to increase infection rates, the most common of which is packing.
<br />
2. Packing is a very effective way to evade static analysis as it obfuscates the majority of the malicious functions within the code.
<br />
3. Packing can be defeated with relative ease by combining static and dyanmic analysis techniques using tools like IDA and x64dbg.
<h1>Injection Techniques</h1>
<h3>DLL Injection</h3>
DLL injection is accomplished by writing a path to a malicious DLL in the memory of another process. The remote process will then create a remote thread to load and execute the DLL. THe malware begins by locating a target process for the injection. This is typically done by calling the CreateToolhelp32Snapshot, Process32First, and Process32Next APIs to get a list of running processes and iterate through them to find the desired target.

Once a target process is identified, the malware calls VirtualAlloc(Ex) to allocate memory in the target process, WriteProcessMemory to write the path to the DLL in the allocated memory, and CreateRemoteThread to call and execute the DLL at the specified path.
<h3>PE Injection</h3>
PE Injection is similar to DLL Injection in that it involves allocating memory, writing to that allocation memory, and creating a remote thread to execute that memory section; however, instead of writing a path to a DLL, the malware writes the malicious code to the allocated memory section.
<h3>Process Hollowing</h3>
Process hollowing differs from the previous two injection techniques in that rather than allocating additional memory to a target process, the technique unmaps (a.k.a. hollowing out) the existing code within a givin memory section of that process, and overwrites it with malicious code.

This technique is often accomplished by calling CreateProcess to create a new process in a suspended state (setting flag 0x00000004) and hollowing out the contents by calling either ZwUnmapViewOfSection or NtUnmapViewOfSection. After the memory is unmapped (or hollowed out) the malware will call VirtualAlloc(Ex) to allocate memory, WriteProcessMemory to write the malicious code to the allocated memory, SetThreadContext to point to the malicious code section, and ResumeThread to resume execution of the process and therefore, the malicious code.
<br />
<br />
<i>Note: For more information on the afformentioned techniques and more, visit https://www.elastic.co/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process.</i>
<h1>Future Direction</h1>
This topic could be explored further by examining additional packing techniques and automating the unpacking process. New packing techniques are likely to arise as developers continue to seek clever ways to pack their code.
